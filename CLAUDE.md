# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Peak Tracker is an iOS app for tracking workouts with wave-loaded periodization (Garage Strength / Peak Strength style). Built with **Tauri v2 + React 18 + TypeScript + Vite + Tailwind CSS + SQLite**.

The original PWA version is preserved as `index.pwa.html` for reference. All new development happens on the `dev` branch.

## Development

```bash
# Install dependencies
npm install

# Run on iOS Simulator
npm run tauri ios dev

# Build for iOS
npm run tauri ios build

# Frontend only (no Tauri, for quick iteration)
npm run dev
```

Requires: Node.js, Rust (via rustup), Xcode 15+.

## Architecture

### Tech Stack
- **Mobile wrapper:** Tauri v2 (Rust, native iOS WebView)
- **Frontend:** React 18 + TypeScript + Vite + Tailwind CSS
- **State:** Zustand (UI state) + SQLite (persistent data via `@tauri-apps/plugin-sql`)
- **Charts:** Recharts
- **IDs:** uuid v4

### Directory Structure

```
src/
  components/          # React components organized by feature
    layout/            # BottomNav (tab bar)
    workout/           # DayTabs, ExerciseCard, SetRow, etc.
    history/           # Charts, StatCards, SetLogList
    programs/          # ProgramBrowser, ProgramBuilder, editors
    goals/             # GoalCard, GoalEditor
    settings/          # SettingsPanel
    dashboard/         # DashboardView
    ui/                # Shared: Button, Input, Modal, Card, Badge
  hooks/               # Custom React hooks (useWorkout, useExerciseSets, etc.)
  lib/                 # Pure logic (no React)
    calc.ts            # roundToNearest5(), estimatedOneRepMax() (Epley formula)
    wave.ts            # getWaveSets() — warmup + working sets from percentages
    constants.ts       # CATEGORY_CONFIG, MAIN_LIFTS, colors
    templates.ts       # Peak Strength template definition
    db.ts              # Singleton DB connection
    seed.ts            # Template seeding + forkTemplate()
  types/               # TypeScript interfaces
    program.ts         # Program, Day, Exercise, WaveConfig, TrainingMax
    log.ts             # WorkoutLog, SetLog, ExerciseNote
    goal.ts            # StrengthGoal
    template.ts        # ProgramTemplate, TemplateExercise, etc.
  store/               # Zustand stores
    appStore.ts        # activeProgramId, currentView, dbReady
    workoutStore.ts    # activeWorkoutLogId, completedSets, noteModal
src-tauri/
  src/lib.rs           # Tauri app setup with SQL plugin + migrations
  migrations/          # SQLite migration files
  Cargo.toml           # Rust dependencies
  tauri.conf.json      # Tauri config (bundle, identifier)
  capabilities/        # Tauri permission capabilities
  gen/apple/           # Xcode project config
```

### Data Model (SQLite)

Two-tier template system:
- **Template tables** (`program_templates`, `exercise_templates`, `wave_config_templates`, etc.) — read-only seed data
- **User tables** (`programs`, `days`, `exercises`, `wave_configs`, etc.) — forked from templates, fully editable

Key tables: `training_maxes` (append-only TM log), `workout_logs` + `set_logs` (workout data), `exercise_notes`, `strength_goals`, `user_settings`.

All IDs are TEXT (UUIDs generated in JavaScript). Schema in `src-tauri/migrations/001_initial_schema.sql`.

### Key Domain Logic

- **Wave sets** generated by `getWaveSets()` in `src/lib/wave.ts` — takes warmups, weeks, weekSets, weekIndex, and currentMax → returns labeled warmup + working sets with calculated weights (rounded to nearest 5)
- **e1RM** uses Epley formula in `src/lib/calc.ts`: `weight * (1 + reps/30)`
- **Template forking** in `src/lib/seed.ts`: deep copies all template data into user-editable tables
- **Main lifts** tracked in charts: bench, squat, deadlift, OHP (defined in `MAIN_LIFTS`)

### Tailwind Theme

```
bg: #0d1117, card: #161b22, input: #0d1117
border: #21262d, focus-border: #f5a623
accent: #f5a623
text: #c9d1d9, bright: #e6edf3, muted: #8b949e, dim: #636e72, faint: #484f58
tech: #e94560, absolute: #f5a623, superset: #4a6fa5, accessory: #636e72
success: #2ea043, danger: #e94560
font: SF Mono, Menlo, Consolas, monospace
```

Colors are configured in `tailwind.config.js` and available as Tailwind classes (e.g., `bg-bg`, `text-accent`, `border-border`).
